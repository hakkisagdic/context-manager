# Future Planned Steps - Skill Seekers Evolution Roadmap

## Product Vision

Transform **context-manager** into **Skill Seekers**: an internationally usable, LLM-friendly product for developers and analysts that summarizes and packages codebases into LLM-ready digests with tight token budgets.

---

## Implementation Phases

### Phase 0: Foundations (Weeks 1-2) - PRIORITY

**Goal:** Stabilize core and prepare for extension

#### 1. Package Restructuring
Extract core into `@skillseekers/core` monorepo structure:
```
@skillseekers/core
 ├─ scanners/           # fs traverse, .gitignore + include/ignore engine
 ├─ analyzers/          # token-utils, method-analyzer, language hooks
 ├─ formatters/         # gitingest, presets, explainability overlays
 ├─ optimizers/         # token budget fitters, delta-aware cache
 ├─ cache/              # checksums, delta index, report history
 ├─ debug/              # rule tracer, pattern visualizer
 └─ api/                # OpenAPI handlers, auth middlewares
```

**Tasks:**
- [ ] Create clean package separation with version guarantees
- [ ] Define stable API surface
- [ ] Setup monorepo tooling (npm workspaces or lerna)
- [ ] Migrate existing code to new structure

#### 2. Preset System Foundation
**Files to create:**
- `lib/presets/preset-manager.js` - Preset orchestrator
- `lib/presets/presets.json` - Preset definitions
- `lib/presets/README.md` - Preset documentation

**Presets to implement:**
- `default` - Standard analysis (current behavior)
- `review` - Code review focus (changed files, core logic)
- `llm-explain` - Ultra-compact for LLM consumption
- `pair-program` - Interactive development context
- `security-audit` - Security-relevant code patterns
- `documentation` - Public API surfaces and docs

**Example preset structure:**
```javascript
{
  "review": {
    "name": "Code Review",
    "description": "Focus on core logic and changed files",
    "filters": {
      "exclude": ["**/*.test.js", "**/*.spec.js", "docs/**"],
      "include": ["src/**/*.js", "lib/**/*.js"]
    },
    "options": {
      "methodLevel": true,
      "gitingest": true,
      "sortBy": "tokens-desc"
    },
    "header": "Code Review Digest - Generated by Skill Seekers",
    "maxTokens": 100000
  }
}
```

#### 3. Token Budget Fitter
**Files to create:**
- `lib/optimizers/token-budget-fitter.js` - Main optimizer
- `lib/optimizers/fit-strategies.js` - Backoff strategies

**Strategies:**
- `auto` - Smart automatic selection
- `shrink-docs` - Exclude documentation first
- `methods-only` - Extract methods, exclude full files
- `top-n` - Select top N files by importance
- `balanced` - Balance coverage vs size

**Algorithm:**
```javascript
class TokenBudgetFitter {
  fitToWindow(files, targetTokens, strategy = 'auto') {
    let current = calculateTotal(files);

    if (current <= targetTokens) return files;

    // Try strategies in order
    if (strategy === 'auto') {
      // 1. Remove docs/comments
      result = tryStrategy('shrink-docs', files, targetTokens);
      if (fits(result)) return result;

      // 2. Method-only extraction
      result = tryStrategy('methods-only', files, targetTokens);
      if (fits(result)) return result;

      // 3. Top-N by importance
      return tryStrategy('top-n', files, targetTokens);
    }

    return executeStrategy(strategy, files, targetTokens);
  }
}
```

#### 4. Rule Debugger/Tracer
**Files to create:**
- `lib/debug/rule-tracer.js` - Rule matching tracer
- `lib/debug/pattern-visualizer.js` - Pattern match viewer

**Features:**
```javascript
class RuleTracer {
  traceFileInclusion(filePath) {
    return {
      file: filePath,
      included: true,
      reason: 'INCLUDE mode active',
      matchedRule: '.calculatorinclude:12',
      pattern: 'src/**/*.js',
      priority: 2
    };
  }

  visualizePatterns(verbose = false) {
    // Show all patterns, what they match, conflicts
  }
}
```

**CLI Usage:**
```bash
context-manager --trace-rules
# Output:
# ✅ src/server.js: INCLUDED by .calculatorinclude:12 (src/**/*.js)
# ❌ test/spec.js: EXCLUDED by .calculatorignore:5 (**/*.test.js)
# ⚠️  docs/api.md: EXCLUDED by .gitignore (no calculator rule)
```

---

### Phase 1: API & Enhanced CLI (Weeks 3-4)

#### 1. REST API
**Framework:** Express.js with OpenAPI 3.0 spec

**Endpoints:**
```javascript
POST   /api/analyze              // Run analysis
POST   /api/digest               // Generate digest with preset
GET    /api/report/:id           // Retrieve report
POST   /api/diff                 // Compare reports
GET    /api/presets              // List available presets
GET    /api/presets/:name        // Get preset details
POST   /api/fit                  // Fit to token budget
```

**Example request:**
```json
POST /api/digest
{
  "source": {
    "type": "git",
    "url": "https://github.com/user/repo.git"
  },
  "preset": "review",
  "targetTokens": 80000,
  "options": {
    "methodLevel": true,
    "deltaOnly": false
  }
}
```

**Files to create:**
- `lib/api/server.js` - Express server
- `lib/api/routes/` - Route handlers
- `lib/api/middleware/` - Auth, validation, rate limiting
- `lib/api/openapi.yaml` - API specification

#### 2. Enhanced CLI
**New flags:**
```bash
--preset <name>              # Use named preset
--target-tokens <number>     # Fit to token budget
--strategy <name>            # Fitting strategy
--trace-rules                # Debug rule matching
--delta-since <ref>          # Export changes since git ref
--compare <file1> <file2>    # Compare two reports
--explain                    # Show decision explanations
```

**Example usage:**
```bash
# Recipe-based workflow
context-manager digest --preset review --target-tokens 80k

# Delta-aware export
context-manager --delta-since main --context-export

# Rule debugging
context-manager --trace-rules --verbose

# Report comparison
context-manager diff report-old.json report-new.json
```

#### 3. Delta-Aware Exports
**Features:**
- Cache file checksums in `.context-cache/`
- Track analysis history
- Export only changed files
- 5-10x speed improvement for incremental updates

**Files to create:**
- `lib/cache/cache-manager.js` - Cache orchestrator
- `lib/cache/checksum-tracker.js` - File hashing
- `lib/cache/delta-calculator.js` - Change detection

**Cache structure:**
```json
{
  "version": "2.0.0",
  "lastAnalysis": "2025-01-15T10:30:00Z",
  "gitRef": "abc123def",
  "files": {
    "src/server.js": {
      "checksum": "sha256:...",
      "tokens": 1234,
      "lastModified": "2025-01-15T09:00:00Z"
    }
  }
}
```

---

### Phase 2: Web & Extension (Weeks 5-8)

#### 1. Web Application (Next.js)
**Tech stack:**
- Next.js 14 (App Router)
- shadcn/ui components
- TailwindCSS
- React Query for API calls

**Pages:**
```
app/
  ├─ page.tsx                    # Landing + upload
  ├─ analyze/
  │   ├─ page.tsx                # Analysis wizard
  │   ├─ preset/page.tsx         # Preset selection
  │   ├─ filters/page.tsx        # Filter configuration
  │   ├─ preview/page.tsx        # Preview digest
  │   └─ export/page.tsx         # Export options
  ├─ reports/
  │   ├─ page.tsx                # Report history
  │   └─ [id]/page.tsx           # Report viewer
  └─ api/
      └─ [...routes]/route.ts    # Proxy to core API
```

**Features:**
- Drag-drop repo ZIP upload
- Git URL import (clone & analyze)
- Interactive preset builder
- Live token count preview
- Export to multiple formats
- Report history & comparison

**Wizard flow:**
1. **Select source**: Upload ZIP, Git URL, or GitHub integration
2. **Choose preset**: Visual preset cards with descriptions
3. **Tune filters**: Interactive pattern builder with live preview
4. **Review digest**: Tree view, token counts, excluded files
5. **Export**: Download digest.txt, copy to clipboard, save report

#### 2. VS Code Extension
**Features:**
- Token count tree view (by file/directory/method)
- Live digest preview panel
- Export commands in command palette
- Status bar token indicator
- File decorations (token badges)

**File structure:**
```
extension/
  ├─ src/
  │   ├─ extension.ts           # Activation & commands
  │   ├─ views/
  │   │   ├─ TokenTreeView.ts   # Tree view provider
  │   │   └─ DigestPanel.ts     # Webview panel
  │   ├─ commands/
  │   │   ├─ analyze.ts         # Run analysis
  │   │   ├─ export.ts          # Export actions
  │   │   └─ preset.ts          # Preset selection
  │   └─ utils/
  │       └─ core-bridge.ts     # Bridge to @skillseekers/core
  └─ package.json               # Extension manifest
```

**Commands:**
- `skillseekers.analyze` - Run analysis on workspace
- `skillseekers.exportDigest` - Export digest to file
- `skillseekers.copyToClipboard` - Copy context to clipboard
- `skillseekers.selectPreset` - Choose preset
- `skillseekers.showTokens` - Show token tree view

---

### Phase 3: i18n & Enterprise (Weeks 9-12)

#### 1. Internationalization
**Supported languages (initial):**
- English (en)
- Turkish (tr)
- Spanish (es)
- German (de)
- Japanese (jp)
- Chinese (zh)

**Implementation:**
- `react-intl` for UI strings
- `i18next` for CLI/API messages
- Locale-aware token heuristics (CJK character density adjustments)
- RTL layout support (Arabic, Hebrew)
- Screen-reader annotations

**Files to create:**
- `lib/i18n/locales/` - Translation files
- `lib/i18n/token-heuristics.js` - Locale-aware token estimation
- `lib/i18n/rtl-support.js` - RTL layout helpers

**Token heuristics:**
```javascript
class LocaleAwareTokenUtils {
  estimateTokens(text, locale = 'en') {
    const baseEstimate = text.length / 4;

    // CJK languages: higher information density
    if (['ja', 'zh', 'ko'].includes(locale)) {
      return baseEstimate * 1.5; // Adjust for character density
    }

    return baseEstimate;
  }
}
```

#### 2. Policy Bundles
**Preset policies for different use cases:**

**Policies:**
- `oss-safe` - Safe for open-source sharing
- `internal` - Internal use only (include all)
- `pii-strip` - Remove PII and sensitive data
- `compliance` - Meet regulatory requirements
- `security` - Security audit focus

**Files to create:**
- `lib/policies/policy-manager.js` - Policy orchestrator
- `lib/policies/secret-scrubber.js` - Secret detection & removal
- `lib/policies/pii-detector.js` - PII detection patterns
- `lib/policies/license-guard.js` - License compliance

**Example policy:**
```javascript
{
  "oss-safe": {
    "name": "Open Source Safe",
    "description": "Safe for public repository sharing",
    "rules": {
      "stripSecrets": true,
      "stripPII": true,
      "allowComments": true,
      "excludePatterns": [
        "**/.env*",
        "**/credentials.json",
        "**/secrets/**",
        "**/*private*"
      ],
      "redactPatterns": [
        /password\s*=\s*["'][^"']+["']/gi,
        /api[_-]?key\s*=\s*["'][^"']+["']/gi,
        /token\s*=\s*["'][^"']+["']/gi
      ]
    },
    "warnings": [
      "Review output before sharing publicly",
      "Check for hardcoded credentials",
      "Verify no API keys present"
    ]
  }
}
```

#### 3. Report Diffs & Trends
**Features:**
- Compare two analysis reports
- Detect token drift over time
- Identify hotspots (growing files/methods)
- Visualize complexity trends

**Files to create:**
- `lib/reporters/diff-generator.js` - Report comparison
- `lib/reporters/trend-analyzer.js` - Trend analysis
- `lib/reporters/hotspot-detector.js` - Growth detection

**Diff output:**
```json
{
  "comparison": {
    "from": "2025-01-01T00:00:00Z",
    "to": "2025-01-15T00:00:00Z",
    "duration": "14 days"
  },
  "summary": {
    "filesAdded": 5,
    "filesRemoved": 2,
    "filesChanged": 12,
    "tokenDrift": +15234,
    "tokenDriftPercent": +8.4
  },
  "hotspots": [
    {
      "file": "src/server.js",
      "tokenChange": +3456,
      "percentChange": +38.2,
      "reason": "New feature added"
    }
  ],
  "trends": {
    "averageFileSize": { "before": 2836, "after": 3124, "change": +10.2 },
    "largestGrowth": "src/handlers/new-feature.js (+5678 tokens)"
  }
}
```

---

## Quick Win Implementation Options

### Option A: Preset System ⭐ RECOMMENDED
**Effort:** 2-3 hours
**Impact:** Immediate UX improvement

**Files to create:**
- `lib/presets/preset-manager.js` (150 lines)
- `lib/presets/presets.json` (200 lines)
- `lib/presets/README.md` (documentation)

**Update:**
- `bin/cli.js` - Add `--preset` flag
- `lib/analyzers/token-calculator.js` - Integrate presets
- `README.md` - Document usage

**Example usage:**
```bash
context-manager --preset review
context-manager --preset llm-explain --target-tokens 50k
context-manager --preset security --save-report
```

**Why start here:**
- Quickest to deliver value
- Foundation for other features
- Aligns with "GitIngest 2.0 presets" priority
- Easy to test and iterate
- Users can immediately use recipes

---

### Option B: Token Budget Fitter
**Effort:** 4-5 hours
**Impact:** Core differentiator

**Files to create:**
- `lib/optimizers/token-budget-fitter.js` (250 lines)
- `lib/optimizers/fit-strategies.js` (300 lines)
- `lib/optimizers/README.md` (documentation)

**Update:**
- `bin/cli.js` - Add `--target-tokens`, `--strategy` flags
- `lib/analyzers/token-calculator.js` - Integrate optimizer

**Example usage:**
```bash
context-manager --target-tokens 100000 --strategy auto
context-manager --target-tokens 80k --strategy methods-only
```

**Why valuable:**
- Solves token window limits (major pain point)
- Differentiates from competitors
- Enables "fit to model" workflows
- Complex but high value

---

### Option C: Rule Debugger
**Effort:** 2 hours
**Impact:** Solves UX confusion

**Files to create:**
- `lib/debug/rule-tracer.js` (100 lines)
- `lib/debug/pattern-visualizer.js` (80 lines)

**Update:**
- `bin/cli.js` - Add `--trace-rules` flag
- `lib/parsers/gitignore-parser.js` - Add tracing hooks

**Example usage:**
```bash
context-manager --trace-rules
context-manager --trace-rules --verbose
```

**Why helpful:**
- Users confused about include/exclude
- Makes debugging patterns easy
- Low effort, high satisfaction
- Foundation for future UI debugging

---

## Success Metrics

**Phase 0 (Foundation):**
- [ ] Preset system supports 5+ presets
- [ ] Token budget fitter achieves 95%+ fit rate
- [ ] Rule tracer provides clear explanations
- [ ] Test coverage > 80%

**Phase 1 (API & CLI):**
- [ ] API handles 100+ req/min
- [ ] Delta-aware exports 5-10x faster
- [ ] CLI supports all presets
- [ ] OpenAPI spec complete

**Phase 2 (UI):**
- [ ] Web app: < 2 min from URL to digest
- [ ] VS Code extension: < 500ms tree view render
- [ ] 80%+ tasks completed via presets (no manual filters)

**Phase 3 (Enterprise):**
- [ ] Support 5+ locales
- [ ] Policy bundles detect 95%+ secrets
- [ ] Report diffs identify hotspots accurately
- [ ] Screen reader compatible (WCAG 2.1 AA)

---

## Technical Debt & Risks

### Current Technical Debt
1. **No AST-based method extraction** - Regex can miss edge cases
2. **No streaming for large repos** - Memory issues on huge codebases
3. **Limited error handling** - Need better error recovery
4. **No caching** - Re-scans everything every time

### Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Regex method extraction misses cases | Medium | Add TypeScript AST mode fallback |
| Over/under-inclusion via patterns | High | Rule visualizer + dry-run preview |
| Large repo performance | High | Streaming + delta-aware cache |
| Token estimation accuracy | Medium | Improve heuristics, require tiktoken |
| API security | High | Auth, rate limiting, input validation |
| Breaking changes during refactor | High | Semantic versioning, deprecation warnings |

---

## Architecture Evolution

### Current (v2.0.0)
```
context-manager/
  ├─ lib/
  │   ├─ analyzers/
  │   ├─ parsers/
  │   ├─ formatters/
  │   └─ utils/
  ├─ bin/cli.js
  └─ index.js
```

### Phase 0 Target (v2.1.0)
```
context-manager/
  ├─ lib/
  │   ├─ presets/         # NEW
  │   ├─ optimizers/      # NEW
  │   ├─ debug/           # NEW
  │   ├─ analyzers/
  │   ├─ parsers/
  │   ├─ formatters/
  │   └─ utils/
  ├─ bin/cli.js
  └─ index.js
```

### Phase 1 Target (v3.0.0)
```
@skillseekers/core/
  ├─ lib/
  │   ├─ api/             # NEW
  │   ├─ cache/           # NEW
  │   ├─ presets/
  │   ├─ optimizers/
  │   ├─ debug/
  │   └─ ...
  └─ ...
```

### Phase 2+ Target (v4.0.0)
```
@skillseekers/
  ├─ core/              # Core library
  ├─ cli/               # CLI package
  ├─ api/               # API server
  ├─ web/               # Next.js app
  ├─ vscode/            # VS Code extension
  └─ shared/            # Shared types/utils
```

---

## Deliverables Checklist

### Phase 0
- [ ] `lib/presets/` - Preset system
- [ ] `lib/optimizers/` - Token budget fitter
- [ ] `lib/debug/` - Rule tracer
- [ ] Updated CLI with new flags
- [ ] Documentation updates
- [ ] Test suite for new features

### Phase 1
- [ ] `lib/api/` - REST API
- [ ] `lib/cache/` - Delta-aware caching
- [ ] OpenAPI specification
- [ ] API documentation
- [ ] CLI enhancements (delta, diff, explain)
- [ ] Report comparison tools

### Phase 2
- [ ] Next.js web application
- [ ] VS Code extension
- [ ] UI component library
- [ ] Wizard flow implementation
- [ ] GitHub integration

### Phase 3
- [ ] i18n support (5+ locales)
- [ ] RTL layout support
- [ ] Policy bundles
- [ ] Secret/PII detection
- [ ] Report diffs & trends
- [ ] Accessibility compliance

---

## Next Actions

1. ✅ Create this roadmap document
2. ⏳ Implement Preset System (Option A)
3. ⏳ Add `--preset` flag to CLI
4. ⏳ Test with example workflows
5. ⏳ Update documentation

---

## Resources & References

**Inspiration:**
- [GitIngest](https://github.com/coderamp-labs/gitingest) - Digest format inspiration
- [tiktoken](https://github.com/openai/tiktoken) - Token counting
- [ripgrep](https://github.com/BurntSushi/ripgrep) - Fast pattern matching

**Tools:**
- Next.js 14 - Web framework
- shadcn/ui - Component library
- Express.js - API server
- VS Code Extension API - Extension development

**Documentation:**
- [docs/GITINGEST_VERSION.md](GITINGEST_VERSION.md) - GitIngest implementation
- [CLAUDE.md](../CLAUDE.md) - Project instructions
- [README.md](../README.md) - User documentation

---

*Last updated: 2025-10-31*
*Version: 1.0.0*
*Status: Planning*
